<!-- app/views/menus/ver.phtml -->
<div class="page-header">
    <h2>
        <i class="fa fa-list"></i> Detalle del Menú
        <div class="pull-right">
            <?php echo Html::link('admin/menus/editar/' . $menu->id, '<i class="fa fa-edit"></i> Editar', 'class="btn btn-primary"'); ?>
            <?php echo Html::link('admin/menus/index', '<i class="fa fa-arrow-left"></i> Volver', 'class="btn btn-default"'); ?>
        </div>
    </h2>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Información del Menú</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-bordered">
                            <tr>
                                <th width="40%">ID:</th>
                                <td><?php echo $menu->id; ?></td>
                            </tr>
                            <tr>
                                <th>Nombre:</th>
                                <td>
                                    <strong><?php echo h($menu->nombre); ?></strong>
                                    <?php if (!empty($menu->icono)): ?>
                                        <span class="pull-right">
                                            <i class="<?php echo h($menu->icono); ?>"></i>
                                        </span>
                                    <?php endif; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>Descripción:</th>
                                <td><?php echo nl2br(h($menu->descripcion)); ?></td>
                            </tr>
                            <tr>
                                <th>Menú Padre:</th>
                                <td>
                                    <?php if (isset($padre)): ?>
                                        <?php echo Html::link('admin/menus/ver/' . $padre->id, 
                                            h($padre->nombre), 
                                            'class="text-primary"'
                                        ); ?>
                                    <?php else: ?>
                                        <span class="text-muted">Menú Raíz</span>
                                    <?php endif; ?>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="col-md-6">
                        <table class="table table-bordered">
                            <tr>
                                <th width="40%">Orden:</th>
                                <td><?php echo $menu->posicion; ?></td>
                            </tr>
                            <tr>
                                <th>Estado:</th>
                                <td>
                                    <?php if ($menu->activo): ?>
                                        <span class="label label-success">
                                            <i class="fa fa-check"></i> Activo
                                        </span>
                                    <?php else: ?>
                                        <span class="label label-danger">
                                            <i class="fa fa-times"></i> Inactivo
                                        </span>
                                    <?php endif; ?>
                                    
                                    <div class="pull-right">
                                        <?php echo Html::link('admin/menus/toggle_activo/' . $menu->id, 
                                            $menu->activo ? 'Desactivar' : 'Activar', 
                                            'class="btn btn-xs ' . ($menu->activo ? 'btn-warning' : 'btn-success') . '"'
                                        ); ?>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>Visible:</th>
                                <td>
                                    <?php if ($menu->visible): ?>
                                        <span class="label label-info">
                                            <i class="fa fa-eye"></i> Visible
                                        </span>
                                    <?php else: ?>
                                        <span class="label label-default">
                                            <i class="fa fa-eye-slash"></i> Oculto
                                        </span>
                                    <?php endif; ?>
                                    
                                    <div class="pull-right">
                                        <?php echo Html::link('admin/menus/toggle_visible/' . $menu->id, 
                                            $menu->visible ? 'Ocultar' : 'Mostrar', 
                                            'class="btn btn-xs ' . ($menu->visible ? 'btn-warning' : 'btn-info') . '"'
                                        ); ?>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>Creado:</th>
                                <td><?php echo ViewHelper::fecha($menu->created_at); ?></td>
                            </tr>
                            <tr>
                                <th>Actualizado:</th>
                                <td><?php echo ViewHelper::fecha($menu->updated_at); ?></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- Información del enlace -->
                <div class="well">
                    <h4>Información del Enlace</h4>
                    
                    <?php if ($recurso): ?>
                        <p>
                            <strong>Tipo:</strong> 
                            <span class="label label-info">Recurso del Sistema</span>
                        </p>
                        <p>
                            <strong>Recurso:</strong>
                            <?php echo h($recurso->nombre); ?>
                            <?php if ($recurso->modulo): ?>
                                (<?php echo h($recurso->modulo); ?>)
                            <?php endif; ?>
                        </p>
                        <p>
                            <strong>Controlador/Acción:</strong>
                            <?php echo h($recurso->controlador); ?>/<?php echo h($recurso->accion); ?>
                        </p>
                    <?php elseif ($menu->url): ?>
                        <p>
                            <strong>Tipo:</strong> 
                            <span class="label label-warning">URL Directa</span>
                        </p>
                        <p>
                            <strong>URL:</strong> 
                            <code><?php echo h($menu->url); ?></code>
                        </p>
                    <?php else: ?>
                        <p>
                            <strong>Tipo:</strong> 
                            <span class="label label-default">Contenedor (sin enlace)</span>
                        </p>
                        <p class="text-muted">
                            Este menú solo agrupa otros menús y no tiene enlace propio.
                        </p>
                    <?php endif; ?>
                    
                    <?php if ($menu->parameters): ?>
                        <p>
                            <strong>Parámetros:</strong>
                            <code><?php echo h($menu->parameters); ?></code>
                        </p>
                    <?php endif; ?>
                    
                    <?php if ($menu->recursos_id || $menu->url): ?>
                        <p>
                            <strong>URL Completa:</strong><br>
                            <a href="<?php echo PUBLIC_PATH . $menu->getUrlCompleta(); ?>" target="_blank" class="btn btn-xs btn-default">
                                <i class="fa fa-external-link"></i> 
                                <?php echo PUBLIC_PATH . $menu->getUrlCompleta(); ?>
                            </a>
                        </p>
                    <?php endif; ?>
                </div>
            </div>
        </div>
        
        <!-- Submenús -->
        <?php if (count($hijos) > 0): ?>
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-sitemap"></i> Submenús
                        <span class="badge"><?php echo count($hijos); ?></span>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="list-group">
                        <?php foreach ($hijos as $hijo): ?>
                            <div class="list-group-item">
                                <div class="pull-right">
                                    <?php echo Html::link('admin/menus/ver/' . $hijo->id, 
                                        '<i class="fa fa-eye"></i>', 
                                        'class="btn btn-xs btn-info" title="Ver"'
                                    ); ?>
                                    <?php echo Html::link('admin/menus/editar/' . $hijo->id, 
                                        '<i class="fa fa-edit"></i>', 
                                        'class="btn btn-xs btn-primary" title="Editar"'
                                    ); ?>
                                </div>
                                
                                <strong>
                                    <?php if (!empty($hijo->icono)): ?>
                                        <i class="<?php echo h($hijo->icono); ?>"></i>
                                    <?php endif; ?>
                                    <?php echo h($hijo->nombre); ?>
                                </strong>
                                
                                <?php if ($hijo->recursos_id): ?>
                                    <span class="label label-info">Recurso</span>
                                <?php elseif ($hijo->url): ?>
                                    <span class="label label-warning">URL</span>
                                <?php else: ?>
                                    <span class="label label-default">Contenedor</span>
                                <?php endif; ?>
                                
                                <br>
                                <small class="text-muted">
                                    Orden: <?php echo $hijo->posicion; ?> | 
                                    <?php echo $hijo->activo ? 'Activo' : 'Inactivo'; ?>
                                </small>
                            </div>
                        <?php endforeach; ?>
                    </div>
                    
                    <div class="text-center">
                        <?php echo Html::link('admin/menus/crear?padre=' . $menu->id, 
                            '<i class="fa fa-plus"></i> Agregar Submenú', 
                            'class="btn btn-info"'
                        ); ?>
                    </div>
                </div>
            </div>
        <?php else: ?>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Submenús</h3>
                </div>
                <div class="panel-body">
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle"></i> Este menú no tiene submenús.
                    </div>
                    <div class="text-center">
                        <?php echo Html::link('admin/menus/crear?padre=' . $menu->id, 
                            '<i class="fa fa-plus"></i> Crear Primer Submenú', 
                            'class="btn btn-info"'
                        ); ?>
                    </div>
                </div>
            </div>
        <?php endif; ?>
    </div>
    
    <!-- Sidebar con Acciones -->
    <div class="col-md-4">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-bolt"></i> Acciones Rápidas</h3>
            </div>
            <div class="panel-body">
                <div class="list-group">
                    <?php echo Html::link('admin/menus/editar/' . $menu->id, 
                        '<i class="fa fa-edit"></i> Editar Menú', 
                        'class="list-group-item"'
                    ); ?>
                    
                    <?php echo Html::link('admin/menus/crear?padre=' . $menu->id, 
                        '<i class="fa fa-plus"></i> Agregar Submenú', 
                        'class="list-group-item"'
                    ); ?>
                    
                    <?php if (count($hijos) == 0): ?>
                        <?php echo Html::link('admin/menus/eliminar/' . $menu->id, 
                            '<i class="fa fa-trash"></i> Eliminar Menú', 
                            'class="list-group-item text-danger btn-delete"'
                        ); ?>
                    <?php else: ?>
                        <a href="#" class="list-group-item text-muted" disabled>
                            <i class="fa fa-trash"></i> Eliminar Menú
                            <small class="pull-right">(tiene submenús)</small>
                        </a>
                    <?php endif; ?>
                    
                    <?php echo Html::link('admin/menus/toggle_activo/' . $menu->id, 
                        '<i class="fa fa-power-off"></i> ' . ($menu->activo ? 'Desactivar' : 'Activar'), 
                        'class="list-group-item"'
                    ); ?>
                    
                    <?php echo Html::link('admin/menus/toggle_visible/' . $menu->id, 
                        '<i class="fa fa-eye"></i> ' . ($menu->visible ? 'Ocultar' : 'Mostrar'), 
                        'class="list-group-item"'
                    ); ?>
                </div>
            </div>
        </div>
        
        <!-- Información de Jerarquía -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <i class="fa fa-sitemap"></i> Jerarquía
                </h3>
            </div>
            <div class="panel-body">
                <ul class="list-unstyled">
                    <?php 
                    // Mostrar ruta completa
                    $ruta = $menu->getArbol(); echo print_r($ruta, true);
                    foreach ($ruta as $item): ?>
                        <li style="margin-left: <?php echo (array_search($item, $ruta) * 20); ?>px;">
                            <?php if ($item->id == $menu->id): ?>
                                <strong>
                                    <i class="fa fa-arrow-right"></i>
                                    <?php echo h($item->nombre); ?>
                                </strong>
                            <?php else: ?>
                                <i class="fa fa-folder"></i>
                                <?php echo Html::link('admin/menus/ver/' . $item->id, h($item->nombre), 'class="text-primary"'); ?>
                            <?php endif; ?>
                        </li>
                    <?php endforeach; ?>
                </ul>
                
                <?php if ($menu->menus_id): ?>
                    <hr>
                    <p>
                        <strong>Menú Padre:</strong><br>
                        <?php echo Html::link('admin/menus/ver/' . $padre->id, 
                            '<i class="fa fa-level-up"></i> ' . h($padre->nombre), 
                            'class="btn btn-xs btn-default"'
                        ); ?>
                    </p>
                <?php endif; ?>
            </div>
        </div>
        
        <!-- Vista Previa -->
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <i class="fa fa-search"></i> Vista Previa
                </h3>
            </div>
            <div class="panel-body">
                <div class="well well-sm" style="background: #f8f9fa; border: 1px dashed #ccc;">
                    <?php if (!empty($menu->icono)): ?>
                        <i class="<?php echo h($menu->icono); ?>"></i>
                    <?php endif; ?>
                    <strong><?php echo h($menu->nombre); ?></strong>
                    
                    <?php if ($menu->recursos_id || $menu->url): ?>
                        <span class="pull-right">
                            <i class="fa fa-external-link"></i>
                        </span>
                    <?php endif; ?>
                </div>
                
                <p class="text-muted small">
                    Así se verá este menú en la interfaz principal.
                </p>
            </div>
        </div>
    </div>
</div>